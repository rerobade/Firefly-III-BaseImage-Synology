# start of inject-custom.txt

VOLUME $FIREFLY_III_PATH/storage/upload

COPY ../conf/locale.gen                     /etc/locale.gen
COPY ../scripts/wait-for-it.sh              /usr/local/bin/wait-for-it.sh
COPY ../scripts/finalize-image.sh           /usr/local/bin/finalize-image.sh

# Script to run common extensions
ADD https://raw.githubusercontent.com/mlocati/docker-php-extension-installer/master/install-php-extensions /usr/local/bin/

RUN set -eux; \
    /usr/sbin/locale-gen && \
    chmod uga+x /usr/local/bin/install-php-extensions && sync && \
    install-php-extensions intl bcmath ldap gd pdo_pgsql pdo_mysql opcache memcached && \
    curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer && \
    cp /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini && \
    sed -i 's/max_execution_time = 30/max_execution_time = 600/' /usr/local/etc/php/php.ini && \
    sed -i 's/memory_limit = 128M/memory_limit = 512M/' /usr/local/etc/php/php.ini && \
    sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 64M/' /usr/local/etc/php/php.ini && \
    sed -i 's/expose_php = On/expose_php = Off/' /usr/local/etc/php/php.ini && \
    sed -i 's/post_max_size = 8M/post_max_size = 64M/' /usr/local/etc/php/php.ini

#USER nonroot
# end of inject-custom.txt
